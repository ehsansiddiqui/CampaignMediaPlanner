@page "/"
@using CampaignMediaPlanner.Services
@inject GoalSeekService GoalSeek
<PageTitle>Home</PageTitle>

<h3>Campaign Media Planner</h3>

<EditForm Model="@parameters" OnValidSubmit="@Calculate">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Total Campaign Budget (Z): </label>
        <InputNumber @bind-Value="parameters.TotalBudget" />
    </div>
    <div>
        <label>Agency Fee Percentage (Y1): </label>
        <InputNumber @bind-Value="parameters.AgencyFeePercentage" />
    </div>
    <div>
        <label>Third-Party Tool Fee Percentage (Y2): </label>
        <InputNumber @bind-Value="parameters.ThirdPartyFeePercentage" />
    </div>
    <div>
        <label>Fixed Costs for Agency Hours: </label>
        <InputNumber @bind-Value="parameters.FixedCosts" />
    </div>
    <div>
        <label>Ad Spend for Other Ads (X_other): </label>
        <InputNumber @bind-Value="parameters.OtherAdSpend" />
    </div>
    <div>
        <label>Initial Guess for Ad Budget: </label>
        <InputNumber @bind-Value="parameters.InitialGuess" />
    </div>

    <button type="submit">Calculate</button>
</EditForm>

@if (result.HasValue)
{
    <p>Calculated Ad Budget: @result.Value</p>
}

@code {
    private Parameters parameters = new Parameters();
    private double? result;

    private void Calculate()
    {
        try
        {
            result = GoalSeek.GoalSeek(Equation, parameters.TotalBudget, parameters.InitialGuess);
        }
        catch (Exception ex)
        {
            result = null;
            // Handle exception (e.g., display error message)
        }
    }

    private double Equation(double x)
    {
        double X = x + parameters.OtherAdSpend;
        return X + parameters.TotalBudget * X + parameters.AgencyFeePercentage * X + parameters.ThirdPartyFeePercentage * (x + parameters.OtherAdSpend) + parameters.FixedCosts;
    }

    private class Parameters
    {
        public double TotalBudget { get; set; }
        public double AgencyFeePercentage { get; set; }
        public double ThirdPartyFeePercentage { get; set; }
        public double FixedCosts { get; set; }
        public double OtherAdSpend { get; set; }
        public double InitialGuess { get; set; }
    }
}